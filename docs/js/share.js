$("html, body").css("font-size",Math.min(window.innerHeight/20,window.innerWidth/15));function getParams(){let results={};let paramList=window.location.search.substr(1).split("&");for(let i=0;i<paramList.length;++i){let param=paramList[i].split("=");results[param[0]]=param[1]}return results}function drawImageFile(ctx,imgFile,x,y){return new Promise(function(resolve,reject){let img=new Image;x=x||0;y=y||0;img.onload=function(){ctx.drawImage(img,x,y);resolve()};img.src=imgFile})}$("document").ready(function(){$("#reserved").hide();let params=getParams();let c=document.getElementById("canvas");let ctx=c.getContext("2d");let resultId=(params["result"]||0).toString();let operation=params["operation"]||"share";let result=resultList[resultId]["result"];drawImageFile(ctx,`../assets/img/share/${resultId}-bg.jpg`).then(function(){return drawImageFile(ctx,`../assets/img/share/text-bg.png`,0,70)}).then(function(){return drawImageFile(ctx,`../assets/img/share/${resultId}-text.png`)}).then(function(){return new Promise(function(resolve,reject){ctx.font="50px XingKai";for(let i=0;i<result.length;++i){ctx.fillText(result[i],115,295+76*i)}resolve()})}).then(function(){return new Promise(function(resolve,reject){ctx.fillStyle="rgba(255, 255, 255, 0.6)";ctx.fillRect(0,900,540,60);resolve()})}).then(function(){return drawImageFile(ctx,"../assets/img/share/yiban.png",130,906)}).then(function(){return drawImageFile(ctx,"../assets/img/share/sdu-online.png",5,911)}).then(function(){return new Promise(function(resolve,reject){if(operation==="share"){drawImageFile(ctx,"../assets/img/share/qr.jpg",415,835).then(function(){return drawImageFile(ctx,"../assets/img/share/qr-text.png",260,912)}).then(resolve)}else{resolve()}})}).then(function(){let output=new Image;output.src=$("#canvas")[0].toDataURL("image/jpg");$("body").append(output);$(".loading").hide()})});